<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic meta -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Wombat Mange Control</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- iOS home-screen icon -->
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <!-- Minimal styling (you can move to a CSS file later) -->
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Segoe UI",sans-serif;background:#d3d3d3;
         display:flex;justify-content:center;align-items:center;min-height:100vh}
    .container{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);
               width:100%;max-width:500px;text-align:center}
    .logo-container img{max-width:150px;margin-bottom:1.5rem}
    h1{font-size:1.5rem;margin-bottom:1.5rem}
    label{display:block;margin-top:1rem;font-size:1rem;text-align:left;color:#444}
    input,button{width:100%;font-size:1rem;padding:.8rem;margin-top:.5rem;margin-bottom:1.2rem;
                 border:1px solid #ddd;border-radius:8px}
    input[type="number"]{width:45%;display:inline-block;margin-right:10%}
    button{background:#4caf50;color:#fff;border:none;cursor:pointer;transition:.3s}
    button:hover:enabled{background:#45a049}
    button:disabled{background:#ddd;cursor:not-allowed}
    .divider{margin-top:2rem;border-top:1px solid #ddd;padding-top:1rem}
    .output{font-weight:bold;font-size:1.1rem;margin-top:.8rem}
    /* modal for stored data */
    #storedDataModal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;
                     justify-content:center;align-items:center}
    #storedDataContent{background:#fff;padding:1rem;border-radius:8px;max-width:400px;
                       width:90%;max-height:80vh;overflow-y:auto;position:relative}
    #closeModalBtn{position:absolute;top:10px;right:10px;background:#ff6b6b;color:#fff;
                   border:none;border-radius:8px;padding:4px 10px;cursor:pointer}
    .stored-entry{border:1px solid #ccc;border-radius:8px;padding:.8rem;margin:1rem 0;text-align:left}
  </style>
</head>
<body>

  <div class="container">
    <!-- Optional local logo -->
    <div class="logo-container">
      <img src="icons/icon-192.png" alt="Logo">  <!-- change or remove as needed -->
    </div>

    <h1>Wombat Mange Control â€“ Data Collection</h1>

    <form id="dataCollectionForm">
      <!-- Contractor & location -->
      <label for="contractorName">Contractor Name:</label>
      <input id="contractorName" name="contractorName" type="text" required>

      <label for="location">Location:</label>
      <input id="location" name="location" type="text" required>

      <!-- Start / finish -->
      <label for="startDateTime">Start Date/Time:</label>
      <input id="startDateTime" name="startDateTime" type="datetime-local" readonly required>

      <label for="endDateTime">Finish Date/Time:</label>
      <input id="endDateTime" name="endDateTime" type="datetime-local" readonly required>

      <!-- Burrow counts -->
      <label for="newBurrows">New Burrows Set:</label>
      <input id="newBurrows" name="newBurrows" type="number" min="0" step="1" required>

      <label for="checkedBurrows">Burrows Checked:</label>
      <input id="checkedBurrows" name="checkedBurrows" type="number" min="0" step="1" required>

      <label for="usedBurrows">Burrows Used:</label>
      <input id="usedBurrows" name="usedBurrows" type="number" min="0" step="1" required>

      <!-- Timer controls -->
      <div class="divider">
        <button id="startBtn" type="button">Start</button>
        <button id="pauseBtn" type="button" disabled>Pause</button>
        <button id="resumeBtn" type="button" disabled>Resume</button>
        <button id="finishBtn" type="button" disabled>Finish</button>

        <div class="output">
          Elapsed&nbsp;<span id="elapsedTime">00:00:00</span>
        </div>
        <div class="output">
          Breaks&nbsp;<span id="breakTime">00:00:00</span>
        </div>
      </div>

      <button type="submit" style="background:#2196f3">Submit</button>
      <button id="viewDataBtn" type="button" style="background:#9c27b0;margin-top:1rem">
        View Stored Data
      </button>
    </form>
  </div>

  <!-- modal -->
  <div id="storedDataModal">
    <div id="storedDataContent">
      <button id="closeModalBtn">Close</button>
      <h2>Stored Submissions</h2>
      <div id="storedDataList"></div>
    </div>
  </div>

  <!-- ---------- JS logic ---------- -->
  <script>
    /* timer + localStorage code exactly as in previous answer */
    const startBtn=document.getElementById('startBtn'),
          pauseBtn=document.getElementById('pauseBtn'),
          resumeBtn=document.getElementById('resumeBtn'),
          finishBtn=document.getElementById('finishBtn'),
          elapsedTimeEl=document.getElementById('elapsedTime'),
          breakTimeEl=document.getElementById('breakTime'),
          startDateTimeEl=document.getElementById('startDateTime'),
          endDateTimeEl=document.getElementById('endDateTime'),
          STORAGE_KEY='wombatData';
    let workStart=null,breakStart=null,totalWorkedMs=0,totalBreakMs=0,timerInterval=null;
    const formatTime=ms=>{let s=Math.floor(ms/1000),h=String(Math.floor(s/3600)).padStart(2,'0');
      s%=3600;let m=String(Math.floor(s/60)).padStart(2,'0');return\`\${h}:\${m}:\${String(s%60).padStart(2,'0')}\`;}
    const updateDisplay=()=>{elapsedTimeEl.textContent=formatTime(totalWorkedMs);
                             breakTimeEl.textContent=formatTime(totalBreakMs);}
    const runTimer=()=>{if(workStart){const now=Date.now();totalWorkedMs+=now-workStart;workStart=now;updateDisplay();}}
    startBtn.onclick=()=>{const nowISO=new Date().toISOString().slice(0,16);
      startDateTimeEl.value=nowISO;endDateTimeEl.value=nowISO;
      totalWorkedMs=0;totalBreakMs=0;workStart=Date.now();updateDisplay();
      startBtn.disabled=true;pauseBtn.disabled=false;resumeBtn.disabled=true;finishBtn.disabled=false;
      timerInterval=setInterval(runTimer,1000);}
    pauseBtn.onclick=()=>{breakStart=Date.now();clearInterval(timerInterval);
      pauseBtn.disabled=true;resumeBtn.disabled=false;}
    resumeBtn.onclick=()=>{if(breakStart){totalBreakMs+=Date.now()-breakStart;breakStart=null;}
      workStart=Date.now();timerInterval=setInterval(runTimer,1000);
      pauseBtn.disabled=false;resumeBtn.disabled=true;}
    finishBtn.onclick=()=>{clearInterval(timerInterval);
      if(breakStart){totalBreakMs+=Date.now()-breakStart;breakStart=null;}
      if(workStart){totalWorkedMs+=Date.now()-workStart;workStart=null;}
      endDateTimeEl.value=new Date().toISOString().slice(0,16);updateDisplay();
      startBtn.disabled=false;pauseBtn.disabled=true;resumeBtn.disabled=true;finishBtn.disabled=true;}
    /* submit saves to localStorage */
    document.getElementById('dataCollectionForm').onsubmit=e=>{
      e.preventDefault();
      const fd=new FormData(e.target), rec={};
      ['contractorName','location','startDateTime','endDateTime',
       'newBurrows','checkedBurrows','usedBurrows'].forEach(k=>rec[k]=fd.get(k));
      rec.totalWork=formatTime(totalWorkedMs);rec.totalBreak=formatTime(totalBreakMs);
      rec.timestamp=new Date().toString();
      const arr=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');arr.push(rec);
      localStorage.setItem(STORAGE_KEY,JSON.stringify(arr));
      e.target.reset();elapsedTimeEl.textContent=breakTimeEl.textContent='00:00:00';
      totalWorkedMs=totalBreakMs=0;startBtn.disabled=false;pauseBtn.disabled=resumeBtn.disabled=finishBtn.disabled=true;
      alert('Saved locally!');};
    /* view locally stored data */
    const viewDataBtn=document.getElementById('viewDataBtn'),
          modal=document.getElementById('storedDataModal'),
          list=document.getElementById('storedDataList');
    viewDataBtn.onclick=()=>{list.innerHTML='';
      const data=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
      if(!data.length){list.innerHTML='<p>No submissions.</p>';}
      else data.forEach((d,i)=>{const div=document.createElement('div');div.className='stored-entry';
        div.innerHTML=\`
          <p><strong>#\${i+1}</strong> (\${d.timestamp})</p>
          <p><strong>Contractor:</strong> \${d.contractorName}</p>
          <p><strong>Location:</strong> \${d.location}</p>
          <p><strong>Start:</strong> \${d.startDateTime}</p>
          <p><strong>Finish:</strong> \${d.endDateTime}</p>
          <p>New Burrows: \${d.newBurrows} | Checked: \${d.checkedBurrows} | Used: \${d.usedBurrows}</p>
          <p>Work: \${d.totalWork} | Break: \${d.totalBreak}</p>\`;list.appendChild(div);});
      modal.style.display='flex';};
    document.getElementById('closeModalBtn').onclick=()=>modal.style.display='none';
    modal.onclick=e=>{if(e.target===modal)modal.style.display='none';};
    /* register service-worker for offline use */
    if('serviceWorker' in navigator)window.addEventListener('load',()=>navigator.serviceWorker
      .register('service-worker.js').catch(console.error));
  </script>
</body>
</html>
